<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="faux">
<title>Randomised Reports • faux</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Randomised Reports">
<meta property="og:description" content="faux">
<meta property="og:image" content="https://debruine.github.io/faux/reference/figures/card.png">
<meta property="og:image:alt" content="Rainbow hexagon with the word FAUX">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@lisadebruine">
<meta name="twitter:site" content="@lisadebruine">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">faux</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.1.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/sim_design.html">Simulate by Design</a>
    <a class="dropdown-item" href="../articles/rnorm_multi.html">Simulate Correlated Variables</a>
    <a class="dropdown-item" href="../articles/norta.html">NORTA</a>
    <a class="dropdown-item" href="../articles/sim_df.html">Simulate from Existing Data</a>
    <a class="dropdown-item" href="../articles/continuous.html">Continuous Predictors</a>
    <a class="dropdown-item" href="../articles/plots.html">Plotting</a>
    <a class="dropdown-item" href="../articles/sim_mixed.html">Mixed Design Simulation</a>
    <a class="dropdown-item" href="../articles/random_reports.html">Randomised Reports</a>
    <a class="dropdown-item" href="../articles/distributions.html">Distribution Conversions</a>
    <a class="dropdown-item" href="../articles/codebook.html">Codebook Demo</a>
    <a class="dropdown-item" href="../articles/contrasts.html">Contrasts</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/debruine/faux/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Randomised Reports</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/debruine/faux/blob/HEAD/vignettes/random_reports.Rmd" class="external-link"><code>vignettes/random_reports.Rmd</code></a></small>
      <div class="d-none name"><code>random_reports.Rmd</code></div>
    </div>

    
    
<p>Have you ever wanted to create unique versions of datasets for each
student in a class? This vignette walks through the process of setting
up a simple study with a subject table and a questionnaire table.</p>
<p>The subjects have varying demographic attributes and are assigned to
a counterbalanced condition and version of the study. Some of the
demographic data is missing.</p>
<p>The questionnaire has a variable number of questions, answered on a
7-point Likert scale. Some of the questions are reverse-coded, indicated
by the column names. There are some missing observations.</p>
<p>The data is set up with fixed effects for condition, version, and
subject language that you can vary between students. The DV is created
using a mixed effects model formula to simulate realistic random
intercepts and slopes, so these data would be suitable for analysis with
mixed effects models, or you can instruct students to aggregate the
questionnaire data to analyse with single-level models.</p>
<p>A custom assignment is created for each student, where they are told
the questionnaire contains scores on one of three topics, and are asked
to determine if there is an effect of one factor for a subgroup of
another factor. The categories chosen here are pretty arbitrary, but you
can change this to make sense for your subject area.</p>
<p>Finally, the subject table, questionnaire table, and instructions are
saved to a folder with the student ID for distribution to each student.
The simulation is seeded with the student ID, ensuring that each student
gets a unique, but reproducible assignment.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Some of the functions below require version 1.1.0 of faux
(<code><a href="../reference/add_random.html">add_random()</a></code>, <code><a href="../reference/add_between.html">add_between()</a></code>,
<code><a href="../reference/add_ranef.html">add_ranef()</a></code> and <code><a href="../reference/add_contrast.html">add_contrast()</a></code>). Any feedback
would be welcome.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::install_github("debruine/faux")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux" class="external-link">faux</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Start your script by setting a seed that is unique to each student.
Below is a useful function you can use to generate a seed from a student
ID, even if it contains letters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seed_from_string</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">seed</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># otherwise set from characters</span></span>
<span>  <span class="va">seed</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">openssl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openssl/man/hash.html" class="external-link">md5</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>       <span class="co"># turn into something with lots of numbers</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[a-z]"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># get rid of letters</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>         <span class="co"># select the first 8 numbers</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">student_id</span> <span class="op">&lt;-</span> <span class="st">"8675309J"</span></span>
<span><span class="fu">seed_from_string</span><span class="op">(</span><span class="va">student_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulate-subjects">Simulate subjects<a class="anchor" aria-label="anchor" href="#simulate-subjects"></a>
</h2>
<p>Now, make a table of subjects.</p>
<div class="section level3">
<h3 id="random-factor">Random factor<a class="anchor" aria-label="anchor" href="#random-factor"></a>
</h3>
<p>In this example, I’m going to choose a random number of subjects
between 300 and 400.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subj_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">400</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>The function <code><a href="../reference/add_random.html">add_random()</a></code> creates the random effects
structure.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj_id <span class="op">=</span> <span class="va">subj_n</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
subj_id
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
subj_id001
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id002
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id003
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id004
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id005
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id006
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="gender">Gender<a class="anchor" aria-label="anchor" href="#gender"></a>
</h3>
<p>Now add a between-subject factor of gender with three levels:
“female”, “male”, and “nonbinary”. If you set the probability of each as
proportions, they will be randomly sampled.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="va">subjects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"nonbinary"</span><span class="op">)</span>,</span>
<span>              .prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.6</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
gender
</th>
<th style="text-align:right;">
n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
129
</td>
</tr>
<tr>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
215
</td>
</tr>
<tr>
<td style="text-align:left;">
nonbinary
</td>
<td style="text-align:right;">
52
</td>
</tr>
</tbody>
</table>
<p>It’s realistic for some people to not want to disclose their gender,
so you can use <code><a href="../reference/messy.html">messy()</a></code> to set some proportion of the
<code>gender</code> column to <code>NA</code>s.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="va">subjects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/messy.html">messy</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.05</span>, <span class="st">"gender"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
gender
</th>
<th style="text-align:right;">
n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
125
</td>
</tr>
<tr>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
202
</td>
</tr>
<tr>
<td style="text-align:left;">
nonbinary
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
19
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="age">Age<a class="anchor" aria-label="anchor" href="#age"></a>
</h3>
<p>Now add an age column. I’m using <code>18 + rpois(nrow(.), 3)</code>
to make a distribution that’s pretty typical of undergraduate students,
but you can choose a simulation function that is relevant to your
questions. I’m also replacing 5% of the values with the word “missing”,
which will convert this to a character column because I want students to
practice dealing with non-standard missing values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="va">subjects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">18</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/messy.html">messy</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.05</span>, <span class="st">"age"</span>, replace <span class="op">=</span> <span class="st">"missing"</span><span class="op">)</span></span></code></pre></div>
<p><img src="random_reports_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="language">Language<a class="anchor" aria-label="anchor" href="#language"></a>
</h3>
<p>Add a between-subjects factor of language, with 70% monolingual and
30% bilingual.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="va">subjects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span>language <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"monolingual"</span>, <span class="st">"bilingual"</span><span class="op">)</span>,</span>
<span>              .prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.7</span>, <span class="fl">.3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="experiment-factors">Experiment factors<a class="anchor" aria-label="anchor" href="#experiment-factors"></a>
</h3>
<p>I want condition and version to be crossed so that there’s an equal
number of subjects in each cell. Specifying both in the same
<code><a href="../reference/add_between.html">add_between()</a></code> accomplishes this.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="va">subjects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>              version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"V1"</span>, <span class="st">"V2"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
condition
</th>
<th style="text-align:left;">
version
</th>
<th style="text-align:right;">
n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V1
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V2
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
V1
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
V2
</td>
<td style="text-align:right;">
99
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="subject-function">Subject function<a class="anchor" aria-label="anchor" href="#subject-function"></a>
</h3>
<p>Now wrap the code for making the subject table in a function. This
makes it easy to make more than one subject table for a simulated study,
for example, to have students practice combining tables.</p>
<p>You can also add other arguments that you might want to vary, like
the names of the condition and version levels. Set the defaults to what
we used in the example above.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_subjects</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subj_n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">400</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                          <span class="va">cond_levels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>                          <span class="va">vers_levels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"V1"</span>, <span class="st">"V2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj_id <span class="op">=</span> <span class="va">subj_n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"nonbinary"</span><span class="op">)</span>,</span>
<span>                .prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.3</span>, <span class="fl">.6</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/messy.html">messy</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.05</span>, <span class="st">"gender"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">18</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/messy.html">messy</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.05</span>, <span class="st">"age"</span>, replace <span class="op">=</span> <span class="st">"missing"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span>language <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"monolingual"</span>, <span class="st">"bilingual"</span><span class="op">)</span>,</span>
<span>                .prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.7</span>, <span class="fl">.3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="va">cond_levels</span>,</span>
<span>                version <span class="op">=</span> <span class="va">vers_levels</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="fu">make_subjects</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
subj_id
</th>
<th style="text-align:left;">
gender
</th>
<th style="text-align:left;">
age
</th>
<th style="text-align:left;">
language
</th>
<th style="text-align:left;">
condition
</th>
<th style="text-align:left;">
version
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
subj_id001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
bilingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V1
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id002
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
monolingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V2
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id003
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
bilingual
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
V1
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id004
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
21
</td>
<td style="text-align:left;">
monolingual
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
V2
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id005
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:left;">
22
</td>
<td style="text-align:left;">
monolingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V1
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id006
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
bilingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V2
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="simulate-questions">Simulate questions<a class="anchor" aria-label="anchor" href="#simulate-questions"></a>
</h2>
<p>Next, we need to set up the questionnaire. I’m going to do this by
adding the question data to the subject table. We’ll extract the
questions into a separate table later, but this will make it easier to
set up the DV using a mixed effects model equation.</p>
<div class="section level3">
<h3 id="random-factor-1">Random factor<a class="anchor" aria-label="anchor" href="#random-factor-1"></a>
</h3>
<p>First, we’ll add the random factor of question, randomly creating 5
to 15 question IDs. The code below adds a cross-classified random
factor, where each subject sees all of the questions. See the <a href="sim_mixed.html">Mixed Design Simulation</a> tutorial to see how to
add nested random factors.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quest_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">15</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="va">subjects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>quest_id <span class="op">=</span> <span class="va">quest_n</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
subj_id
</th>
<th style="text-align:left;">
gender
</th>
<th style="text-align:left;">
age
</th>
<th style="text-align:left;">
language
</th>
<th style="text-align:left;">
condition
</th>
<th style="text-align:left;">
version
</th>
<th style="text-align:left;">
quest_id
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
subj_id001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
bilingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V1
</td>
<td style="text-align:left;">
quest_id1
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
bilingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V1
</td>
<td style="text-align:left;">
quest_id2
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
bilingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V1
</td>
<td style="text-align:left;">
quest_id3
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
bilingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V1
</td>
<td style="text-align:left;">
quest_id4
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
bilingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V1
</td>
<td style="text-align:left;">
quest_id5
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id002
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:left;">
19
</td>
<td style="text-align:left;">
monolingual
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
V2
</td>
<td style="text-align:left;">
quest_id1
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="question-reversing">Question reversing<a class="anchor" aria-label="anchor" href="#question-reversing"></a>
</h3>
<p>I want some of the questions to be reverse-coded, so I’m adding a
between-question factor of <code>reversed</code> with levels “F” and
“R”. Here, we specify the <code>.by =</code> argument to show that this
factor should vary by question. We didn’t need this in the code above
because there was only one random factor to vary over, but by default
this function varies over all random factors if there is more than
one.</p>
<p>I set <code>.shuffle = TRUE</code> so that the questions are randomly
assigned forward and reversed values, rather than odd questions being
forward and even questions being reversed. This will require a more
sophisticated method to wrangle the resulting data, and the
randomisation means that different students’ datasets need different
code.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="va">questions</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"quest_id"</span>, reversed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"R"</span><span class="op">)</span>, .shuffle <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
quest_id
</th>
<th style="text-align:left;">
reversed
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
quest_id1
</td>
<td style="text-align:left;">
R
</td>
</tr>
<tr>
<td style="text-align:left;">
quest_id2
</td>
<td style="text-align:left;">
F
</td>
</tr>
<tr>
<td style="text-align:left;">
quest_id3
</td>
<td style="text-align:left;">
R
</td>
</tr>
<tr>
<td style="text-align:left;">
quest_id4
</td>
<td style="text-align:left;">
F
</td>
</tr>
<tr>
<td style="text-align:left;">
quest_id5
</td>
<td style="text-align:left;">
F
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="random-effects">Random effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h3>
<p>Now we set the random effects structure. The function
<code><a href="../reference/add_ranef.html">add_ranef()</a></code> lets you add columns that sample values from a
normal distribution with a mean of 0 and the specified SD. If you have
example data, you can get realistic values for the random effects SDs
from a mixed effects model (see <a href="https://debruine.github.io/lmem_sim/" class="external-link">this tutorial</a>).</p>
<p>Here, we’re setting the SD for the subject’s random intercept to 2,
and the SDs for the random slopes of language, condition, and version to
1. We set a small, positive correlation among all of these random
effect. Each time you run this function, different values from this
joint distribution will be sampled.</p>
<p>We also add a random intercept by question to account for the fact
that some questions will have higher or lower values than the mean.</p>
<p>Finally add an overall error term, <code>sigma</code>, which will
vary by subject and question (so you can skip the first <code>.by</code>
argument).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="va">questions</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"subj_id"</span>, </span>
<span>            s0i <span class="op">=</span> <span class="fl">2</span>, </span>
<span>            s_lang <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            s_cond <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            s_vers <span class="op">=</span> <span class="fl">1</span>, </span>
<span>            .cors <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span>.by <span class="op">=</span> <span class="st">"quest_id"</span>, q0i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fixed-effects">Fixed effects<a class="anchor" aria-label="anchor" href="#fixed-effects"></a>
</h3>
<p>Now we can calculate the DV. First, I want the fixed effects in each
dataset to vary, so I’m setting the fixed effect values by sampling from
-05., 0 and +0.5 for each of language, condition, and version.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lang_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cond_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">vers_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="factor-contrasts">Factor contrasts<a class="anchor" aria-label="anchor" href="#factor-contrasts"></a>
</h3>
<p>Next, we add contrasts to recode the fixed factors into numbers. See
the <a href="contrasts.html">contrasts vignette</a> for more details.
For a 2-level factor, this sets the first level of the factor to a value
of -0.5 and the second level to +0.5.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="va">questions</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"language"</span>, add_cols <span class="op">=</span> <span class="cn">T</span>, colnames <span class="op">=</span> <span class="st">"lang"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, add_cols <span class="op">=</span> <span class="cn">T</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, add_cols <span class="op">=</span> <span class="cn">T</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-dv">Calculate DV<a class="anchor" aria-label="anchor" href="#calculate-dv"></a>
</h3>
<p>Now, we can calculate the DV as the sum of the grand mean
(<code>0</code>), plus the random intercepts (<code>s0i</code> and
<code>q0i</code>). This simulates how some subjects tend to use higher
or lower points on the scale, and some questions have higher or lower
mean values.</p>
<p>Next, we add the coded versions of each fixed factor, multiplied by
their effect size plus the subject’s random slope for that effect. This
simulates how some subjects show systematically larger or smaller
effects.</p>
<p>Finally, we add the error term (<code>sigma</code>).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="va">questions</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">s0i</span> <span class="op">+</span> <span class="va">q0i</span> <span class="op">+</span></span>
<span>           <span class="op">(</span><span class="va">s_lang</span> <span class="op">+</span> <span class="va">lang_effect</span><span class="op">)</span> <span class="op">*</span> <span class="va">lang</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">s_cond</span> <span class="op">+</span> <span class="va">cond_effect</span><span class="op">)</span> <span class="op">*</span> <span class="va">cond</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="va">s_vers</span> <span class="op">+</span> <span class="va">vers_effect</span><span class="op">)</span> <span class="op">*</span> <span class="va">vers</span> <span class="op">+</span></span>
<span>           <span class="va">sigma</span><span class="op">)</span></span></code></pre></div>
<p><img src="random_reports_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="recode-dv">Recode DV<a class="anchor" aria-label="anchor" href="#recode-dv"></a>
</h3>
<p>For this assignment, I want the DV to be from a Likert scale, so I’m
going to convert <code>dv</code> from a normal distribution to a Likert
scale with 7 points with the proportions below. The second mutate
reverses the questions that should be reverse-coded.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="va">questions</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="fu"><a href="../reference/norm2likert.html">norm2likert</a></span><span class="op">(</span><span class="va">dv</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         dv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">reversed</span> <span class="op">==</span> <span class="st">"R"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">-</span> <span class="fl">8</span><span class="op">)</span>, <span class="va">dv</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="random_reports_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="reshape-data">Reshape data<a class="anchor" aria-label="anchor" href="#reshape-data"></a>
</h3>
<p>Here, I’m creating a <code>quest_name</code> column from the
<code>quest_id</code> and <code>reversed</code> columns.
<code>sample(2:3)</code> returns these columns in a random order. I then
unite the columns with a randomly sampled separator. This will produce
question names like <code>F-q04</code> or <code>q10 R</code>. While
putting information about the questions in the name isn’t great practice
for recording data, it’s unfortunately very common and dealing with it
is a skill I want my students to practice.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="st">"-"</span>, <span class="st">" "</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="va">questions</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subj_id</span>, <span class="va">quest_id</span>, <span class="va">reversed</span>, <span class="va">dv</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">quest_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, sep <span class="op">=</span> <span class="va">sep</span><span class="op">)</span> </span></code></pre></div>
<p>I then make 0.5% of the observations missing, pivot the table from
long to wide format, and sample 95% of the subjects, so that the number
of subjects in the subjects table doesn’t exactly match the number in
the questions table, and is in a different order.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="va">questions</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/messy.html">messy</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">.005</span>, <span class="st">"dv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">quest_name</span>, values_from <span class="op">=</span> <span class="va">dv</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="questionnaire-function">Questionnaire function<a class="anchor" aria-label="anchor" href="#questionnaire-function"></a>
</h3>
<p>Now wrap the code for making the questionnaire table in a function.
You can use this to make several questionnaires per student to practice
joining tables.</p>
<p>This code needs the subjects table as an argument. You can add the
other randomised values as arguments. I also added
<code>likert_prob</code> as an argument so you can easily customise the
number of points on the Likert scale and their relative proportions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># randomise between students</span></span>
<span><span class="va">make_quest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subjects</span>,</span>
<span>                       <span class="va">quest_n</span> <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">15</span>,</span>
<span>                       <span class="va">sep</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">""</span>, <span class="st">"-"</span>, <span class="st">" "</span><span class="op">)</span>,</span>
<span>                       <span class="va">lang_effect</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                       <span class="va">cond_effect</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                       <span class="va">vers_effect</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                       <span class="va">likert_prob</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.05</span>, <span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.3</span>, <span class="fl">.2</span>, <span class="fl">.1</span>, <span class="fl">.05</span><span class="op">)</span></span>
<span>                       <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># sample values</span></span>
<span>  <span class="va">quest_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">quest_n</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">sep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">sep</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">lang_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">lang_effect</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">cond_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">cond_effect</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">vers_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">vers_effect</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">subjects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>quest_id <span class="op">=</span> <span class="va">quest_n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"quest_id"</span>, reversed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="st">"subj_id"</span>, </span>
<span>              s0i <span class="op">=</span> <span class="fl">2</span>, </span>
<span>              s_lang <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              s_cond <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              s_vers <span class="op">=</span> <span class="fl">1</span>, </span>
<span>              .cors <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="st">"quest_id"</span>, q0i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"language"</span>, add_cols <span class="op">=</span> <span class="cn">T</span>, colnames <span class="op">=</span> <span class="st">"lang"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"condition"</span>, add_cols <span class="op">=</span> <span class="cn">T</span>, colnames <span class="op">=</span> <span class="st">"cond"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"version"</span>, add_cols <span class="op">=</span> <span class="cn">T</span>, colnames <span class="op">=</span> <span class="st">"vers"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="va">s0i</span> <span class="op">+</span> <span class="va">q0i</span> <span class="op">+</span> <span class="va">sigma</span> <span class="op">+</span></span>
<span>             <span class="op">(</span><span class="va">s_lang</span> <span class="op">+</span> <span class="va">lang_effect</span><span class="op">)</span> <span class="op">*</span> <span class="va">lang</span> <span class="op">+</span> </span>
<span>             <span class="op">(</span><span class="va">s_cond</span> <span class="op">+</span> <span class="va">cond_effect</span><span class="op">)</span> <span class="op">*</span> <span class="va">cond</span> <span class="op">+</span> </span>
<span>             <span class="op">(</span><span class="va">s_vers</span> <span class="op">+</span> <span class="va">vers_effect</span><span class="op">)</span> <span class="op">*</span> <span class="va">vers</span>,</span>
<span>           dv <span class="op">=</span> <span class="fu"><a href="../reference/norm2likert.html">norm2likert</a></span><span class="op">(</span><span class="va">dv</span>, prob <span class="op">=</span> <span class="va">likert_prob</span><span class="op">)</span>,</span>
<span>           dv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">reversed</span> <span class="op">==</span> <span class="st">"R"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">-</span> <span class="fl">8</span><span class="op">)</span>, <span class="va">dv</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subj_id</span>, <span class="va">quest_id</span>, <span class="va">reversed</span>, <span class="va">dv</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span><span class="va">quest_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, sep <span class="op">=</span> <span class="va">sep</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/messy.html">messy</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">.005</span>, <span class="st">"dv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">quest_name</span>, values_from <span class="op">=</span> <span class="va">dv</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">questions</span> <span class="op">&lt;-</span> <span class="fu">make_quest</span><span class="op">(</span><span class="va">subjects</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
subj_id
</th>
<th style="text-align:right;">
F-quest_id1
</th>
<th style="text-align:right;">
R-quest_id2
</th>
<th style="text-align:right;">
F-quest_id3
</th>
<th style="text-align:right;">
R-quest_id4
</th>
<th style="text-align:right;">
F-quest_id5
</th>
<th style="text-align:right;">
R-quest_id6
</th>
<th style="text-align:right;">
F-quest_id7
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
subj_id267
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id098
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id023
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id259
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id249
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
subj_id008
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="generate-random-assignment">Generate random assignment<a class="anchor" aria-label="anchor" href="#generate-random-assignment"></a>
</h2>
<p>I also want each student to have a different research question to
answer with these data.</p>
<div class="section level3">
<h3 id="write-text">Write text<a class="anchor" aria-label="anchor" href="#write-text"></a>
</h3>
<p>First, write the text you want to give to the students. You can use
fancier methods for this, like <a href="https://bookdown.org/yihui/rmarkdown/parameterized-reports.html" class="external-link">parametrised
R Markdown reports</a>, but this is a simple and effective strategy. Put
variables you want to randomise inside curly brackets, and we’ll sample
those and insert the using <code><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue::glue()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">research_question_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">"\n\n"</span>,</span>
<span>  <span class="st">"=== Reproducible Report for {student_id} ==="</span>,</span>
<span>  </span>
<span>  <span class="st">"Your questionnaire measures {topic}. Your research question is to determine if the {topic} score differs by {iv} for the subset of the sample where {subset} is {level}."</span>,</span>
<span>  </span>
<span>  <span class="st">"The {quest_n} {topic} questionnaire items are on a scale from 1 (low) to 7 (high), but some of the items need to be reverse-coded. This is indicated by the letter R in the question column name. You create the {topic} score by summing the questions."</span>,</span>
<span>  </span>
<span>  <span class="st">"Watch out for missing data. You can decide whether to omit subjects with missing data or replace the missing data; just explain your choice and its consequences in the report."</span>,</span>
<span>  </span>
<span>  <span class="st">"The report should be written like a summary document for your PI. You don't need to show your code in the rendered report. Include summary tables and/or plots with subject demographics from both the full data set and the subset you'll analyse. Visualise the relationship of interest. Conduct a GLM analysis to answer the research question above. Finally, do a power analysis to determine the sample size you would need to have {power}% power to detect a 0.5-point difference between the levels of {iv} with an alpha criterion of {alpha}."</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can save this to an external file if you want and read it from
there. In this way, you can create more than one set of template
instructions and also randomly assign that.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write to a template file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">research_question_text</span>, <span class="st">"template_instructions.txt"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-random-aspects">Define random aspects<a class="anchor" aria-label="anchor" href="#define-random-aspects"></a>
</h3>
<p>Now define the variables from the text above. I want the
<code>iv</code> and <code>subset</code> to be two different factors from
the list of “language”, “condition”, and “version”. Then I sample one of
the levels of the <code>subset</code> factor.</p>
<p>I sample a topic from “stress”, “extroversion”, and “disgust”. You
can choose relevant topics for your discipline, of course.</p>
<p>I also sample an alpha level and power for the power calculation
aspect of the assessment. This reinforces a lesson I want to teach about
alpha = 0.5 and target power = 0.8 being mindless defaults that we
should question. <a href="https://osf.io/j4s3c/" class="external-link">Justify
everything</a>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"language"</span>, <span class="st">"condition"</span>, <span class="st">"version"</span><span class="op">)</span></span>
<span><span class="va">two_factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">factors</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">iv</span> <span class="op">&lt;-</span> <span class="va">two_factors</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">subset</span> <span class="op">&lt;-</span> <span class="va">two_factors</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">level</span> <span class="op">&lt;-</span> <span class="va">subjects</span><span class="op">[[</span><span class="va">subset</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">topic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stress"</span>, <span class="st">"extroversion"</span>, <span class="st">"disgust"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.005</span>, <span class="fl">.01</span>, <span class="fl">.05</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">85</span>, <span class="fl">90</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>This will produce the following text.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">instructions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"template_instructions.txt"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>=== Reproducible Report for 8675309J ===</p>
<p>Your questionnaire measures extroversion. Your research question is
to determine if the extroversion score differs by version for the subset
of the sample where condition is A.</p>
<p>The 5 extroversion questionnaire items are on a scale from 1 (low) to
7 (high), but some of the items need to be reverse-coded. This is
indicated by the letter R in the question column name. You create the
extroversion score by summing the questions.</p>
<p>Watch out for missing data. You can decide whether to omit subjects
with missing data or replace the missing data; just explain your choice
and its consequences in the report.</p>
<p>The report should be written like a summary document for your PI. You
don’t need to show your code in the rendered report. Include summary
tables and/or plots with subject demographics from both the full data
set and the subset you’ll analyse. Visualise the relationship of
interest. Conduct a GLM analysis to answer the research question above.
Finally, do a power analysis to determine the sample size you would need
to have 80% power to detect a 0.5-point difference between the levels of
version with an alpha criterion of 0.01.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="instructions-function">Instructions function<a class="anchor" aria-label="anchor" href="#instructions-function"></a>
</h3>
<p>As before, wrap this code in a function.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_instructions</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">template</span>, </span>
<span>                              <span class="va">subjects</span>,</span>
<span>                              <span class="va">factors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"language"</span>, <span class="st">"condition"</span>, <span class="st">"version"</span><span class="op">)</span>,</span>
<span>                              <span class="va">topics</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stress"</span>, <span class="st">"extroversion"</span>, <span class="st">"disgust"</span><span class="op">)</span>,</span>
<span>                              <span class="va">...</span> <span class="co"># other values you need for the template, like student_id</span></span>
<span>                              <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">two_factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">factors</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">iv</span> <span class="op">&lt;-</span> <span class="va">two_factors</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">subset</span> <span class="op">&lt;-</span> <span class="va">two_factors</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">level</span> <span class="op">&lt;-</span> <span class="va">subjects</span><span class="op">[[</span><span class="va">subset</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">topic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">topics</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.005</span>, <span class="fl">.01</span>, <span class="fl">.05</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">power</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">85</span>, <span class="fl">90</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">template</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">make_instructions</span><span class="op">(</span>template <span class="op">=</span> <span class="st">"template_instructions.txt"</span>,</span>
<span>                  subjects <span class="op">=</span> <span class="va">subjects</span>,</span>
<span>                  student_id <span class="op">=</span> <span class="va">student_id</span>,</span>
<span>                  quest_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">questions</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; === Reproducible Report for 8675309J ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Your questionnaire measures stress. Your research question is to determine if the stress score differs by condition for the subset of the sample where version is V2.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The 5 stress questionnaire items are on a scale from 1 (low) to 7 (high), but some of the items need to be reverse-coded. This is indicated by the letter R in the question column name. You create the stress score by summing the questions.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Watch out for missing data. You can decide whether to omit subjects with missing data or replace the missing data; just explain your choice and its consequences in the report.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The report should be written like a summary document for your PI. You don't need to show your code in the rendered report. Include summary tables and/or plots with subject demographics from both the full data set and the subset you'll analyse. Visualise the relationship of interest. Conduct a GLM analysis to answer the research question above. Finally, do a power analysis to determine the sample size you would need to have 85% power to detect a 0.5-point difference between the levels of condition with an alpha criterion of 0.005.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="save-files">Save files<a class="anchor" aria-label="anchor" href="#save-files"></a>
</h2>
<p>Now you need to create a directory for the student’s files and save
the subject table, question table, and instructions. I’m saving the
files in a directory that contains the student ID so I can upload them
to Moodle easily.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"exam_"</span>, <span class="va">student_id</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">subjects</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"subjects.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">questions</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"questions.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">instructions</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"instructions.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-function">Simulation function<a class="anchor" aria-label="anchor" href="#simulation-function"></a>
</h2>
<p>Once you’ve debugged your code above, put each step inside a function
with the argument <code>student_id</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_project</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">student_id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># set seed using student ID</span></span>
<span>  <span class="fu">seed_from_string</span><span class="op">(</span><span class="va">student_id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># simulate subjects</span></span>
<span>  <span class="va">subjects</span> <span class="op">&lt;-</span> <span class="fu">make_subjects</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># simulate questionnaire</span></span>
<span>  <span class="va">questions</span> <span class="op">&lt;-</span> <span class="fu">make_quest</span><span class="op">(</span><span class="va">subjects</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># customise instructions</span></span>
<span>  <span class="va">instructions</span> <span class="op">&lt;-</span> <span class="fu">make_instructions</span><span class="op">(</span></span>
<span>    template <span class="op">=</span> <span class="st">"template_instructions.txt"</span>,</span>
<span>    subjects <span class="op">=</span> <span class="va">subjects</span>,</span>
<span>    student_id <span class="op">=</span> <span class="va">student_id</span>,</span>
<span>    quest_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">questions</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write files to a new directory</span></span>
<span>  <span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"exam_"</span>, <span class="va">student_id</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">subjects</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"subjects.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">questions</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"questions.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">instructions</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"instructions.txt"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now you can map over a list of student IDs to create personalised
data and research questions for each student. Here is the pattern if you
have student IDs in a table in a column called
<code>Student ID</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load student IDs</span></span>
<span><span class="va">student_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  `Student ID` <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># iterate over the IDs to create a random project</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">student_list</span><span class="op">$</span><span class="va">`Student ID`</span>, <span class="va">random_project</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lisa DeBruine.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
