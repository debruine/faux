<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mixed Design Simulation • faux</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Mixed Design Simulation">
<meta property="og:description" content="faux">
<meta property="og:image" content="https://debruine.github.io/faux/reference/figures/card.png">
<meta property="og:image:alt" content="Blue hexagon with the word FAUX in white">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@lisadebruine">
<meta name="twitter:site" content="@lisadebruine">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">faux</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sim_design.html">Simulate by Design</a>
    </li>
    <li>
      <a href="../articles/rnorm_multi.html">Simulate Correlated Variables</a>
    </li>
    <li>
      <a href="../articles/norta.html">NORTA</a>
    </li>
    <li>
      <a href="../articles/sim_df.html">Simulate from Existing Data</a>
    </li>
    <li>
      <a href="../articles/continuous.html">Continuous Predictors</a>
    </li>
    <li>
      <a href="../articles/plots.html">Plotting</a>
    </li>
    <li>
      <a href="../articles/sim_mixed.html">Mixed Design Simulation</a>
    </li>
    <li>
      <a href="../articles/random_reports.html">Randomised Reports</a>
    </li>
    <li>
      <a href="../articles/distributions.html">Distribution Conversions</a>
    </li>
    <li>
      <a href="../articles/codebook.html">Codebook Demo</a>
    </li>
    <li>
      <a href="../articles/contrasts.html">Contrasts</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/debruine/faux/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mixed Design Simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/debruine/faux/blob/HEAD/vignettes/sim_mixed.Rmd" class="external-link"><code>vignettes/sim_mixed.Rmd</code></a></small>
      <div class="hidden name"><code>sim_mixed.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/runehaubo/lmerTestR" class="external-link">lmerTest</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/broom.mixed" class="external-link">broom.mixed</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/debruine/faux" class="external-link">faux</a></span><span class="op">)</span></span></code></pre></div>
<p>This <a href="https://osf.io/3cz2e/" class="external-link">paper</a> provides a tutorial
and examples for more complex designs.</p>
<div class="section level2">
<h2 id="building-multilevel-designs">Building multilevel designs<a class="anchor" aria-label="anchor" href="#building-multilevel-designs"></a>
</h2>
<p>You can build up a mixed effects model by adding random factors in a
stepwise fashion using <code><a href="../reference/add_random.html">add_random()</a></code>. The example below
simulates 3 schools with 2, 3 and 4 classes nested in each school.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>school <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, .nested_in <span class="op">=</span> <span class="st">"school"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">school</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">school1</td>
<td align="left">class1</td>
</tr>
<tr class="even">
<td align="left">school1</td>
<td align="left">class2</td>
</tr>
<tr class="odd">
<td align="left">school2</td>
<td align="left">class3</td>
</tr>
<tr class="even">
<td align="left">school2</td>
<td align="left">class4</td>
</tr>
<tr class="odd">
<td align="left">school2</td>
<td align="left">class5</td>
</tr>
<tr class="even">
<td align="left">school3</td>
<td align="left">class6</td>
</tr>
<tr class="odd">
<td align="left">school3</td>
<td align="left">class7</td>
</tr>
<tr class="even">
<td align="left">school3</td>
<td align="left">class8</td>
</tr>
<tr class="odd">
<td align="left">school3</td>
<td align="left">class9</td>
</tr>
</tbody>
</table>
<p>A cross-classified design with 2 subjects and 3 items.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="fl">2</span>, item <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">item</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">item1</td>
</tr>
<tr class="even">
<td align="left">subj1</td>
<td align="left">item2</td>
</tr>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">item3</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">item1</td>
</tr>
<tr class="odd">
<td align="left">subj2</td>
<td align="left">item2</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">item3</td>
</tr>
</tbody>
</table>
<p>You can also name the items directly if you don’t like the default
names. Crossed factors can be named with a vector of names, while nested
factors need to be a list with one vector of names for each nesting
level.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>school <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hyndland Primary"</span>, <span class="st">"Hyndland Secondary"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             .nested_in <span class="op">=</span> <span class="st">"school"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">school</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Hyndland Primary</td>
<td align="left">P1</td>
</tr>
<tr class="even">
<td align="left">Hyndland Primary</td>
<td align="left">P2</td>
</tr>
<tr class="odd">
<td align="left">Hyndland Secondary</td>
<td align="left">S1</td>
</tr>
<tr class="even">
<td align="left">Hyndland Secondary</td>
<td align="left">S2</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="adding-fixed-factors">Adding fixed factors<a class="anchor" aria-label="anchor" href="#adding-fixed-factors"></a>
</h2>
<p>Add within factors with <code><a href="../reference/add_within.html">add_within()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_within.html">add_within</a></span><span class="op">(</span><span class="st">"subj"</span>, time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pre"</span>, <span class="st">"post"</span><span class="op">)</span>,</span>
<span>             condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">time</th>
<th align="left">condition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">pre</td>
<td align="left">control</td>
</tr>
<tr class="even">
<td align="left">subj1</td>
<td align="left">pre</td>
<td align="left">test</td>
</tr>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">post</td>
<td align="left">control</td>
</tr>
<tr class="even">
<td align="left">subj1</td>
<td align="left">post</td>
<td align="left">test</td>
</tr>
<tr class="odd">
<td align="left">subj2</td>
<td align="left">pre</td>
<td align="left">control</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">pre</td>
<td align="left">test</td>
</tr>
<tr class="odd">
<td align="left">subj2</td>
<td align="left">post</td>
<td align="left">control</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">post</td>
<td align="left">test</td>
</tr>
</tbody>
</table>
<p>Add between factors with <code><a href="../reference/add_between.html">add_between()</a></code>. If you have more
than one factor, they will be crossed. If you set
<code>.shuffle = TRUE</code>, the factors will be added randomly (not in
“order”), and separately added factors may end up confounded. This
simulates true random allocation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="fl">4</span>, item <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"test"</span><span class="op">)</span>, gen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"item"</span>, version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subj"</span>, <span class="st">"item"</span><span class="op">)</span>, shuffled <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, .shuffle <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subj"</span>, <span class="st">"item"</span><span class="op">)</span>, not_shuffled <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, .shuffle <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">item</th>
<th align="left">cond</th>
<th align="left">gen</th>
<th align="left">version</th>
<th align="right">shuffled</th>
<th align="right">not_shuffled</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">item1</td>
<td align="left">control</td>
<td align="left">X</td>
<td align="left">A</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">subj1</td>
<td align="left">item2</td>
<td align="left">control</td>
<td align="left">X</td>
<td align="left">B</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">subj2</td>
<td align="left">item1</td>
<td align="left">control</td>
<td align="left">Z</td>
<td align="left">A</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">item2</td>
<td align="left">control</td>
<td align="left">Z</td>
<td align="left">B</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">subj3</td>
<td align="left">item1</td>
<td align="left">test</td>
<td align="left">X</td>
<td align="left">A</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">subj3</td>
<td align="left">item2</td>
<td align="left">test</td>
<td align="left">X</td>
<td align="left">B</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">subj4</td>
<td align="left">item1</td>
<td align="left">test</td>
<td align="left">Z</td>
<td align="left">A</td>
<td align="right">4</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">subj4</td>
<td align="left">item2</td>
<td align="left">test</td>
<td align="left">Z</td>
<td align="left">B</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="unequal-cells">Unequal cells<a class="anchor" aria-label="anchor" href="#unequal-cells"></a>
</h3>
<p>If the levels of a factor don’t have equal probability, set the
probability with <code>.prob</code>. If the sum of the values equals the
number of groups, you will always get those exact numbers (e.g., always
8 control and 2 test; set shuffle = TRUE to get them in a random order).
Otherwise, the values are sampled and the exact proportions will change
for each simulation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"test"</span><span class="op">)</span>, .prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"young"</span>, <span class="st">"old"</span><span class="op">)</span>, .prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">cond</th>
<th align="left">age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj01</td>
<td align="left">control</td>
<td align="left">old</td>
</tr>
<tr class="even">
<td align="left">subj02</td>
<td align="left">control</td>
<td align="left">young</td>
</tr>
<tr class="odd">
<td align="left">subj03</td>
<td align="left">control</td>
<td align="left">old</td>
</tr>
<tr class="even">
<td align="left">subj04</td>
<td align="left">control</td>
<td align="left">young</td>
</tr>
<tr class="odd">
<td align="left">subj05</td>
<td align="left">control</td>
<td align="left">young</td>
</tr>
<tr class="even">
<td align="left">subj06</td>
<td align="left">control</td>
<td align="left">young</td>
</tr>
<tr class="odd">
<td align="left">subj07</td>
<td align="left">control</td>
<td align="left">young</td>
</tr>
<tr class="even">
<td align="left">subj08</td>
<td align="left">control</td>
<td align="left">old</td>
</tr>
<tr class="odd">
<td align="left">subj09</td>
<td align="left">test</td>
<td align="left">young</td>
</tr>
<tr class="even">
<td align="left">subj10</td>
<td align="left">test</td>
<td align="left">young</td>
</tr>
</tbody>
</table>
<p>If you have more than one between-subject factor, setting them
together allows you to set joint proportions for each cell.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, </span>
<span>              cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"test"</span><span class="op">)</span>,</span>
<span>              age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"young"</span>, <span class="st">"old"</span><span class="op">)</span>, </span>
<span>              .prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">cond</th>
<th align="left">age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj01</td>
<td align="left">control</td>
<td align="left">young</td>
</tr>
<tr class="even">
<td align="left">subj02</td>
<td align="left">control</td>
<td align="left">young</td>
</tr>
<tr class="odd">
<td align="left">subj03</td>
<td align="left">control</td>
<td align="left">old</td>
</tr>
<tr class="even">
<td align="left">subj04</td>
<td align="left">control</td>
<td align="left">old</td>
</tr>
<tr class="odd">
<td align="left">subj05</td>
<td align="left">control</td>
<td align="left">old</td>
</tr>
<tr class="even">
<td align="left">subj06</td>
<td align="left">test</td>
<td align="left">young</td>
</tr>
<tr class="odd">
<td align="left">subj07</td>
<td align="left">test</td>
<td align="left">young</td>
</tr>
<tr class="even">
<td align="left">subj08</td>
<td align="left">test</td>
<td align="left">young</td>
</tr>
<tr class="odd">
<td align="left">subj09</td>
<td align="left">test</td>
<td align="left">young</td>
</tr>
<tr class="even">
<td align="left">subj10</td>
<td align="left">test</td>
<td align="left">old</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="counterbalanced-designs">Counterbalanced designs<a class="anchor" aria-label="anchor" href="#counterbalanced-designs"></a>
</h3>
<p>You can use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> function from dplyr to create
counterbalanced designs. For example, if your items are grouped into A
and B counterbalanced groups, add a between-subjects and a between-items
factor with the same levels and filter only rows where the subject value
matches the item value. In the example below, odd-numbered subjects only
respond to odd-numbered items.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="fl">4</span>, item <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, subj_cb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"odd"</span>, <span class="st">"even"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"item"</span>, item_cb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"odd"</span>, <span class="st">"even"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subj_cb</span> <span class="op">==</span> <span class="va">item_cb</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">item</th>
<th align="left">subj_cb</th>
<th align="left">item_cb</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">item1</td>
<td align="left">odd</td>
<td align="left">odd</td>
</tr>
<tr class="even">
<td align="left">subj1</td>
<td align="left">item3</td>
<td align="left">odd</td>
<td align="left">odd</td>
</tr>
<tr class="odd">
<td align="left">subj2</td>
<td align="left">item2</td>
<td align="left">even</td>
<td align="left">even</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">item4</td>
<td align="left">even</td>
<td align="left">even</td>
</tr>
<tr class="odd">
<td align="left">subj3</td>
<td align="left">item1</td>
<td align="left">odd</td>
<td align="left">odd</td>
</tr>
<tr class="even">
<td align="left">subj3</td>
<td align="left">item3</td>
<td align="left">odd</td>
<td align="left">odd</td>
</tr>
<tr class="odd">
<td align="left">subj4</td>
<td align="left">item2</td>
<td align="left">even</td>
<td align="left">even</td>
</tr>
<tr class="even">
<td align="left">subj4</td>
<td align="left">item4</td>
<td align="left">even</td>
<td align="left">even</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="recoding">Recoding<a class="anchor" aria-label="anchor" href="#recoding"></a>
</h3>
<p>To set up data for analysis, you often need to recode categorical
variables. Use the helper function <code><a href="../reference/add_contrast.html">add_contrast()</a></code> for this.
The code below creates anova-coded and treatment-coded versions of
“cond” and the two variables needed to treatment-code the 3-level
variable “type”. See the <a href="contrasts.html">contrasts vignette</a>
for more details.</p>
<p>You can <code><a href="../reference/add_recode.html">add_recode()</a></code> for setting a manual contrast that
isn’t available in <code><a href="../reference/add_contrast.html">add_contrast()</a></code>, such as weighted
contrasts.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="fl">2</span>, item <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"item"</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># add contrasts</span></span>
<span>  <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"cond"</span>, <span class="st">"anova"</span>, add_cols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"cond"</span>, <span class="st">"treatment"</span>, add_cols <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># you can change the default column names</span></span>
<span>  <span class="fu"><a href="../reference/add_contrast.html">add_contrast</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"treatment"</span>, add_cols <span class="op">=</span> <span class="cn">TRUE</span>, colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_recode.html">add_recode</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"type.w"</span>, X <span class="op">=</span> <span class="op">-</span><span class="fl">1.3</span>, Y <span class="op">=</span> <span class="fl">0</span>, Z <span class="op">=</span> <span class="fl">0.92</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">item</th>
<th align="left">cond</th>
<th align="left">type</th>
<th align="right">cond.B-A</th>
<th align="right">cond.B-A.tr</th>
<th align="right">Y</th>
<th align="right">Z</th>
<th align="right">type.w</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">item1</td>
<td align="left">A</td>
<td align="left">X</td>
<td align="right">-0.5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-1.30</td>
</tr>
<tr class="even">
<td align="left">subj1</td>
<td align="left">item2</td>
<td align="left">A</td>
<td align="left">Y</td>
<td align="right">-0.5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">item3</td>
<td align="left">A</td>
<td align="left">Z</td>
<td align="right">-0.5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.92</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">item1</td>
<td align="left">B</td>
<td align="left">X</td>
<td align="right">0.5</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">-1.30</td>
</tr>
<tr class="odd">
<td align="left">subj2</td>
<td align="left">item2</td>
<td align="left">B</td>
<td align="left">Y</td>
<td align="right">0.5</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">item3</td>
<td align="left">B</td>
<td align="left">Z</td>
<td align="right">0.5</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.92</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="adding-random-effects">Adding random effects<a class="anchor" aria-label="anchor" href="#adding-random-effects"></a>
</h2>
<p>To simulate multilevel data, you need to add random intercepts and
slopes for each random factor (or combination of random factors). These
are randomly sampled each time you simulate a new sample, so you can
only characterise them by their standard deviation. You can use the
function <code><a href="../reference/add_ranef.html">add_ranef()</a></code> to add random effects with specified
SDs. If you add more than one random effect for the same group (e.g., a
random intercept and a random slope), you can specify their correlation
with <code>.cors</code> (you can specify correlations in the same way as
for <code><a href="../reference/rnorm_multi.html">rnorm_multi()</a></code>).</p>
<p>The code below sets up a simple cross-classified design where 2
subjects are crossed with 2 items. It adds a between-subject,
within-item factor of “version”. Then it adds random effects by subject,
item, and their interaction, as well as an error term
(<code>sigma</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="fl">4</span>, item <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, version <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># add by-subject random intercept</span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="st">"subj"</span>, u0s <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># add by-item random intercept and slope</span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="st">"item"</span>, u0i <span class="op">=</span> <span class="fl">1.5</span>, u1i <span class="op">=</span> <span class="fl">1.5</span>, .cors <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># add by-subject:item random intercept</span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subj"</span>, <span class="st">"item"</span><span class="op">)</span>, u0si <span class="op">=</span> <span class="fl">1.7</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># add error term (by observation)</span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fl">2.2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">item</th>
<th align="right">version</th>
<th align="right">u0s</th>
<th align="right">u0i</th>
<th align="right">u1i</th>
<th align="right">u0si</th>
<th align="right">sigma</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj1</td>
<td align="left">item1</td>
<td align="right">1</td>
<td align="right">1.175</td>
<td align="right">-2.549</td>
<td align="right">0.952</td>
<td align="right">-1.531</td>
<td align="right">1.503</td>
</tr>
<tr class="even">
<td align="left">subj1</td>
<td align="left">item2</td>
<td align="right">1</td>
<td align="right">1.175</td>
<td align="right">-0.811</td>
<td align="right">-1.595</td>
<td align="right">-0.256</td>
<td align="right">1.518</td>
</tr>
<tr class="odd">
<td align="left">subj2</td>
<td align="left">item1</td>
<td align="right">2</td>
<td align="right">-2.014</td>
<td align="right">-2.549</td>
<td align="right">0.952</td>
<td align="right">-1.407</td>
<td align="right">1.174</td>
</tr>
<tr class="even">
<td align="left">subj2</td>
<td align="left">item2</td>
<td align="right">2</td>
<td align="right">-2.014</td>
<td align="right">-0.811</td>
<td align="right">-1.595</td>
<td align="right">3.376</td>
<td align="right">-0.409</td>
</tr>
<tr class="odd">
<td align="left">subj3</td>
<td align="left">item1</td>
<td align="right">1</td>
<td align="right">1.329</td>
<td align="right">-2.549</td>
<td align="right">0.952</td>
<td align="right">0.075</td>
<td align="right">0.842</td>
</tr>
<tr class="even">
<td align="left">subj3</td>
<td align="left">item2</td>
<td align="right">1</td>
<td align="right">1.329</td>
<td align="right">-0.811</td>
<td align="right">-1.595</td>
<td align="right">-0.687</td>
<td align="right">0.828</td>
</tr>
<tr class="odd">
<td align="left">subj4</td>
<td align="left">item1</td>
<td align="right">2</td>
<td align="right">0.195</td>
<td align="right">-2.549</td>
<td align="right">0.952</td>
<td align="right">-0.804</td>
<td align="right">2.538</td>
</tr>
<tr class="even">
<td align="left">subj4</td>
<td align="left">item2</td>
<td align="right">2</td>
<td align="right">0.195</td>
<td align="right">-0.811</td>
<td align="right">-1.595</td>
<td align="right">-0.705</td>
<td align="right">3.465</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="simulating-data">Simulating data<a class="anchor" aria-label="anchor" href="#simulating-data"></a>
</h2>
<p>Now you can define your data-generating parameters and put everything
together to simulate a dataset. In this example,subject are crossed with
items, and there is a single treatment-coded between-subject,
within-item fixed factor of condition with levels “control” and “test”.
The intercept and effect of condition are both set to 0. The SDs of the
random intercepts and slopes are all set to 1 (you will need pilot data
to estimate realistic values for your design), the correlation between
the random intercept and slope by items is set to 0. The SD of the error
term is set to 2.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define parameters</span></span>
<span><span class="va">subj_n</span> <span class="op">=</span> <span class="fl">10</span>  <span class="co"># number of subjects</span></span>
<span><span class="va">item_n</span> <span class="op">=</span> <span class="fl">10</span>  <span class="co"># number of items</span></span>
<span><span class="va">b0</span> <span class="op">=</span> <span class="fl">0</span>       <span class="co"># intercept</span></span>
<span><span class="va">b1</span> <span class="op">=</span> <span class="fl">0</span>       <span class="co"># fixed effect of condition</span></span>
<span><span class="va">u0s_sd</span> <span class="op">=</span> <span class="fl">1</span>   <span class="co"># random intercept SD for subjects</span></span>
<span><span class="va">u0i_sd</span> <span class="op">=</span> <span class="fl">1</span>   <span class="co"># random intercept SD for items</span></span>
<span><span class="va">u1i_sd</span> <span class="op">=</span> <span class="fl">1</span>   <span class="co"># random b1 slope SD for items</span></span>
<span><span class="va">r01i</span> <span class="op">=</span> <span class="fl">0</span>     <span class="co"># correlation between random effects 0 and 1 for items</span></span>
<span><span class="va">sigma_sd</span> <span class="op">=</span> <span class="fl">2</span> <span class="co"># error SD</span></span>
<span>  </span>
<span><span class="co"># set up data structure</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="va">subj_n</span>, item <span class="op">=</span> <span class="va">item_n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># add and recode categorical variables</span></span>
<span>  <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_recode.html">add_recode</a></span><span class="op">(</span><span class="st">"cond"</span>, <span class="st">"cond.t"</span>, control <span class="op">=</span> <span class="fl">0</span>, test <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># add random effects </span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="st">"subj"</span>, u0s <span class="op">=</span> <span class="va">u0s_sd</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="st">"item"</span>, u0i <span class="op">=</span> <span class="va">u0i_sd</span>, u1i <span class="op">=</span> <span class="va">u1i_sd</span>, .cors <span class="op">=</span> <span class="va">r01i</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="va">sigma_sd</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># calculate DV</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="va">b0</span> <span class="op">+</span> <span class="va">u0s</span> <span class="op">+</span> <span class="va">u0i</span> <span class="op">+</span> <span class="op">(</span><span class="va">b1</span> <span class="op">+</span> <span class="va">u1i</span><span class="op">)</span> <span class="op">*</span> <span class="va">cond.t</span> <span class="op">+</span> <span class="va">sigma</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="11%">
<col width="11%">
<col width="12%">
<col width="11%">
<col width="9%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">subj</th>
<th align="left">item</th>
<th align="left">cond</th>
<th align="right">cond.t</th>
<th align="right">u0s</th>
<th align="right">u0i</th>
<th align="right">u1i</th>
<th align="right">sigma</th>
<th align="right">dv</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">subj01</td>
<td align="left">item01</td>
<td align="left">control</td>
<td align="right">0</td>
<td align="right">0.589</td>
<td align="right">2.135</td>
<td align="right">0.684</td>
<td align="right">-2.351</td>
<td align="right">0.373</td>
</tr>
<tr class="even">
<td align="left">subj01</td>
<td align="left">item02</td>
<td align="left">control</td>
<td align="right">0</td>
<td align="right">0.589</td>
<td align="right">-0.214</td>
<td align="right">-0.252</td>
<td align="right">-0.284</td>
<td align="right">0.090</td>
</tr>
<tr class="odd">
<td align="left">subj01</td>
<td align="left">item03</td>
<td align="left">control</td>
<td align="right">0</td>
<td align="right">0.589</td>
<td align="right">0.947</td>
<td align="right">-0.151</td>
<td align="right">1.802</td>
<td align="right">3.337</td>
</tr>
<tr class="even">
<td align="left">subj01</td>
<td align="left">item04</td>
<td align="left">control</td>
<td align="right">0</td>
<td align="right">0.589</td>
<td align="right">0.652</td>
<td align="right">-0.875</td>
<td align="right">0.716</td>
<td align="right">1.957</td>
</tr>
<tr class="odd">
<td align="left">subj01</td>
<td align="left">item05</td>
<td align="left">control</td>
<td align="right">0</td>
<td align="right">0.589</td>
<td align="right">-0.729</td>
<td align="right">-1.977</td>
<td align="right">-1.837</td>
<td align="right">-1.977</td>
</tr>
<tr class="even">
<td align="left">subj01</td>
<td align="left">item06</td>
<td align="left">control</td>
<td align="right">0</td>
<td align="right">0.589</td>
<td align="right">-1.050</td>
<td align="right">0.238</td>
<td align="right">-2.644</td>
<td align="right">-3.105</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="analysing-your-multilevel-data">Analysing your multilevel data<a class="anchor" aria-label="anchor" href="#analysing-your-multilevel-data"></a>
</h2>
<p>You can analyse these data with lme4::lmer().</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">cond.t</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subj</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">cond.t</span> <span class="op">|</span> <span class="va">item</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML. t-tests use Satterthwaite's method [</span></span>
<span><span class="co">#&gt; lmerModLmerTest]</span></span>
<span><span class="co">#&gt; Formula: dv ~ cond.t + (1 | subj) + (1 + cond.t | item)</span></span>
<span><span class="co">#&gt;    Data: data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 421</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">#&gt; -1.94554 -0.66137  0.03661  0.66655  2.39501 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev. Corr </span></span>
<span><span class="co">#&gt;  subj     (Intercept) 0.3239   0.5691        </span></span>
<span><span class="co">#&gt;  item     (Intercept) 0.7649   0.8746        </span></span>
<span><span class="co">#&gt;           cond.t      1.1253   1.0608   -0.66</span></span>
<span><span class="co">#&gt;  Residual             3.2817   1.8115        </span></span>
<span><span class="co">#&gt; Number of obs: 100, groups:  subj, 10; item, 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error       df t value Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept) -0.05392    0.45486  9.66296  -0.119    0.908</span></span>
<span><span class="co">#&gt; cond.t      -0.58770    0.61102  9.08258  -0.962    0.361</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;        (Intr)</span></span>
<span><span class="co">#&gt; cond.t -0.690</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="power-simulation">Power simulation<a class="anchor" aria-label="anchor" href="#power-simulation"></a>
</h2>
<p>Include this code in a function so you can easily change the Ns,
fixed effects, and random effects to any values. Then run a mixed
effects model on the data and return the model.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">subj_n</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">item_n</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                <span class="va">b0</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">b1</span> <span class="op">=</span> <span class="fl">0</span>,         <span class="co"># fixed effects </span></span>
<span>                <span class="va">u0s_sd</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">u0i_sd</span> <span class="op">=</span> <span class="fl">1</span>, <span class="co"># random intercepts</span></span>
<span>                <span class="va">u1i_sd</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">r01i</span> <span class="op">=</span> <span class="fl">0</span>,   <span class="co"># random slope and cor</span></span>
<span>                <span class="va">sigma_sd</span> <span class="op">=</span> <span class="fl">2</span>,           <span class="co"># error term</span></span>
<span>                <span class="va">...</span> <span class="co"># helps the function work with pmap() below</span></span>
<span>                <span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># set up data structure</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_random.html">add_random</a></span><span class="op">(</span>subj <span class="op">=</span> <span class="va">subj_n</span>, item <span class="op">=</span> <span class="va">item_n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># add and recode categorical variables</span></span>
<span>    <span class="fu"><a href="../reference/add_between.html">add_between</a></span><span class="op">(</span><span class="st">"subj"</span>, cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_recode.html">add_recode</a></span><span class="op">(</span><span class="st">"cond"</span>, <span class="st">"cond.t"</span>, control <span class="op">=</span> <span class="fl">0</span>, test <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># add random effects </span></span>
<span>    <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="st">"subj"</span>, u0s <span class="op">=</span> <span class="va">u0s_sd</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span><span class="st">"item"</span>, u0i <span class="op">=</span> <span class="va">u0i_sd</span>, u1i <span class="op">=</span> <span class="va">u1i_sd</span>, .cors <span class="op">=</span> <span class="va">r01i</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_ranef.html">add_ranef</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="va">sigma_sd</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co"># calculate DV</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dv <span class="op">=</span> <span class="va">b0</span> <span class="op">+</span> <span class="va">u0s</span> <span class="op">+</span> <span class="va">u0i</span> <span class="op">+</span> <span class="op">(</span><span class="va">b1</span> <span class="op">+</span> <span class="va">u1i</span><span class="op">)</span> <span class="op">*</span> <span class="va">cond.t</span> <span class="op">+</span> <span class="va">sigma</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># run mixed effect model and return relevant values</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">dv</span> <span class="op">~</span> <span class="va">cond.t</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subj</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">cond.t</span> <span class="op">|</span> <span class="va">item</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">broom.mixed</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Check the function. Here, we’re simulating a fixed effect of
condition (b1) of 0.5 for 50 subjects and 40 items, with a correlation
between the random intercept and slope for items of 0.2, and the default
values for all other parameters that we set above.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sim</span><span class="op">(</span>subj_n <span class="op">=</span> <span class="fl">50</span>, item_n <span class="op">=</span> <span class="fl">40</span>, b1 <span class="op">=</span> <span class="fl">0.5</span>, r01i <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 8</span></span></span>
<span><span class="co">#&gt;   effect   group    term                   estim…¹ std.e…² stati…³    df p.value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> fixed    <span style="color: #BB0000;">NA</span>       (Intercept)            -<span style="color: #BB0000;">0.071</span><span style="color: #BB0000; text-decoration: underline;">5</span>   0.286  -<span style="color: #BB0000;">0.250</span>  71.4   0.803</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> fixed    <span style="color: #BB0000;">NA</span>       cond.t                  0.499    0.395   1.27   68.1   0.210</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ran_pars subj     sd__(Intercept)         1.19    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ran_pars item     sd__(Intercept)         0.913   <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ran_pars item     cor__(Intercept).cond…  0.256   <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ran_pars item     sd__cond.t              1.16    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> ran_pars Residual sd__Observation         2.08    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​estimate, ²​std.error, ³​statistic</span></span></span></code></pre></div>
<p>Run the simulation repeatedly. I’m only running it 50 times per
parameter combination here so my demo doesn’t take forever to run, but
once you are done testing a range of parameters, you probably want to
run the final simulation 100-1000 times. You might get a few warnings
like “Model failed to converge” or “singular boundary”. You don’t need
to worry too much if you only get a few of these. If most of your models
have warnings, the simulation parameters are likely to be off.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span></span>
<span>  rep <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="co"># number of replicates</span></span>
<span>  subj_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>, <span class="co"># range of subject N</span></span>
<span>  item_n <span class="op">=</span> <span class="fl">25</span>, <span class="co"># fixed item N</span></span>
<span>  b1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span><span class="op">)</span>, <span class="co"># range of effects</span></span>
<span>  r01i <span class="op">=</span> <span class="fl">0.2</span> <span class="co"># fixed correlation</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>analysis <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">pmap</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">sim</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></span></code></pre></div>
<p>Filter and/or group the resulting table and calculate the proportion
of p.values above your alpha threshold to get power for the fixed
effects.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate power for alpha = 0.05</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">effect</span> <span class="op">==</span> <span class="st">"fixed"</span>, <span class="va">term</span> <span class="op">==</span> <span class="st">"cond.t"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">b1</span>, <span class="va">subj_n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">)</span>, </span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">b1</span>, <span class="va">subj_n</span>, fill <span class="op">=</span> <span class="va">power</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">power</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="sim_mixed_files/figure-html/powerplot-1.png" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lisa DeBruine.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
